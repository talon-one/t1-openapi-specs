# path: /v2/customer_sessions/{customerSessionId}/reopen
put:
  operationId: reopenCustomerSession
  summary: Reopen customer session
  description: >
    Reopen a closed [customer
    session](https://docs.talon.one/docs/dev/concepts/entities/customer-sessions).

    For example, if a session has been completed but still needs to be edited,
    you can reopen it with this endpoint.

    A reopen session is treated like a standard open session.


    When reopening a session:

    - The `talon_session_reopened` event is triggered. You can see it in the
    **Events** view in the Campaign Manager.

    - The session state is updated to `open`.

    - Any modified budgets and triggered effects are rolled back when the
    session closes.

    - Depending on the [return
    policy](https://docs.talon.one/docs/product/loyalty-programs/managing-loyalty-programs#return-policy)
     in your loyalty programs, points are rolled back in the following ways:
      - Pending points are rolled back automatically.
      - If **Active points deduction** setting is enabled, any points that were earned and activated when the session closed 
      are rolled back.
      - If **Negative balance** is enabled, the rollback can create a negative points balance.


    <details>
      <summary><strong>Effects and budgets unimpacted by a session reopening</strong></summary>
      <div>
        <p>The following effects and budgets remain in the state they were in when the session closed:</p>
        <ul>
          <li>Add free item effect</li>
          <li>Award giveaway</li>
          <li>Coupon and referral creation</li>
          <li>Coupon reservation</li>
          <li>Custom effect</li>
          <li>Update attribute value</li>
          <li>Update cart item attribute value</li>
        </ul>
      </div>


    </details>

    <p>To see an example of a rollback, see the <a
    href="https://docs.talon.one/docs/dev/tutorials/rolling-back-effects">Cancelling
    a session with campaign budgets</a>tutorial.</p>


    **Note:** If your order workflow requires you to create a new session
    instead of reopening a session, use the

    [Update customer
    session](https://docs.talon.one/integration-api#tag/Customer-sessions/operation/updateCustomerSessionV2)
    endpoint to cancel

    a closed session and create a new one.
  security:
    - api_key_v1: []
  tags:
    - Customer sessions
  parameters:
    - name: customerSessionId
      in: path
      required: true
      description: >
        The `integration ID` of the customer session. You set this ID when you
        create a customer session.


        You can see existing customer session integration IDs in the Campaign
        Manager's **Sessions** menu, or via the

        [List Application
        session](https://docs.talon.one/management-api#operation/getApplicationSessions)
        endpoint.
      example: session1
      schema:
        type: string
  responses:
    '200':
      description: OK
      content:
        application/json:
          schema:
            type: object
            description: >
              This is the response type returned by the Reopen customer sessions
              endpoint. It contains the rolled back effects.
            required:
              - effects
            properties:
              effects:
                type: array
                description: >-
                  The effects generated by the rules in your running campaigns.
                  See [API
                  effects](https://docs.talon.one/docs/dev/integration-api/api-effects).
                items:
                  allOf:
                    - type: object
                      description: >-
                        Definition of all properties that are present on all
                        effects, independent of their type.
                      required:
                        - campaignId
                        - rulesetId
                        - ruleIndex
                        - ruleName
                        - effectType
                      properties:
                        campaignId:
                          type: integer
                          description: The ID of the campaign that triggered this effect.
                          example: 244
                        rulesetId:
                          type: integer
                          description: >-
                            The ID of the ruleset that was active in the
                            campaign when this effect was triggered.
                          example: 73
                        ruleIndex:
                          type: integer
                          description: >-
                            The position of the rule that triggered this effect
                            within the ruleset.
                          example: 2
                        ruleName:
                          type: string
                          description: The name of the rule that triggered this effect.
                          example: Give 20% discount
                        effectType:
                          type: string
                          description: >-
                            The type of effect that was triggered. See [API
                            effects](https://docs.talon.one/docs/dev/integration-api/api-effects).
                          example: rejectCoupon
                        triggeredByCoupon:
                          type: integer
                          example: 4928
                          description: >-
                            The ID of the coupon that was being evaluated when
                            this effect was triggered.
                        triggeredForCatalogItem:
                          type: integer
                          example: 786
                          description: >-
                            The ID of the catalog item that was being evaluated
                            when this effect was triggered.
                        conditionIndex:
                          type: integer
                          example: 786
                          description: The index of the condition that was triggered.
                        evaluationGroupID:
                          type: integer
                          example: 3
                          description: >-
                            The ID of the evaluation group. For more
                            information, see [Managing campaign
                            evaluation](https://docs.talon.one/docs/product/applications/managing-campaign-evaluation).
                        evaluationGroupMode:
                          type: string
                          example: stackable
                          description: >-
                            The evaluation mode of the evaluation group. For
                            more information, see [Managing campaign
                            evaluation](https://docs.talon.one/docs/product/applications/managing-campaign-evaluation).
                        campaignRevisionId:
                          type: integer
                          example: 1
                          description: >-
                            The revision ID of the campaign that was used when
                            triggering the effect.
                        campaignRevisionVersionId:
                          type: integer
                          example: 5
                          description: >-
                            The revision version ID of the campaign that was
                            used when triggering the effect.
                        selectedPriceType:
                          type: string
                          example: member
                          description: >-
                            The selected price type for the SKU targeted by this
                            effect.
                        selectedPrice:
                          type: number
                          example: 100
                          description: >-
                            The value of the selected price type to apply to the
                            SKU targeted by this effect, before any discounts
                            are applied.
                        adjustmentReferenceId:
                          type: string
                          format: uuid
                          example: 68851723-e6fa-488f-ace9-112581e6c19b
                          description: >-
                            The reference identifier of the selected price
                            adjustment for this SKU. This is only returned if
                            the `selectedPrice` resulted from a price
                            adjustment.
                    - type: object
                      description: >-
                        A generic effect that is fired by a triggered campaign.
                        The props property will contain information specific to
                        the specific effect type.
                      required:
                        - props
                      properties:
                        props:
                          oneOf:
                            - type: object
                              description: >-
                                The properties specific to the "acceptCoupon"
                                effect. This gets triggered whenever the coupon
                                is valid and all other conditions in the rules
                                of its campaign are met.
                              required:
                                - value
                              properties:
                                value:
                                  type: string
                                  description: The coupon code that was accepted.
                            - type: object
                              description: >-
                                The properties specific to the "acceptReferral"
                                effect. TThis gets triggered whenever the
                                referral code is valid and all other conditions
                                in the rules of its campaign are met.
                              required:
                                - value
                              properties:
                                value:
                                  type: string
                                  description: The referral code that was accepted.
                            - type: object
                              description: >
                                This effect is **deprecated**. The properties
                                specific to the "redeemReferral" effect.

                                This gets triggered whenever the referral code
                                is valid, and a rule was triggered that contains
                                a "redeem referral" effect.
                              required:
                                - id
                                - value
                              properties:
                                id:
                                  type: integer
                                  description: >-
                                    The id of the referral code that was
                                    redeemed.
                                value:
                                  type: string
                                  description: The referral code that was redeemed.
                            - type: object
                              description: >-
                                The properties specific to the "rejectCoupon"
                                effect. This gets triggered whenever the coupon
                                was rejected. See rejectionReason for more info
                                on why.
                              required:
                                - value
                                - rejectionReason
                              properties:
                                value:
                                  type: string
                                  description: The coupon code that was rejected.
                                rejectionReason:
                                  type: string
                                  description: The reason why this coupon was rejected.
                                conditionIndex:
                                  type: integer
                                  description: >-
                                    The index of the condition that caused the
                                    rejection of the coupon.
                                effectIndex:
                                  type: integer
                                  description: >-
                                    The index of the effect that caused the
                                    rejection of the coupon.
                                details:
                                  type: string
                                  description: More details about the failure.
                                campaignExclusionReason:
                                  type: string
                                  example: CampaignGaveLowerDiscount
                                  description: The reason why the campaign was not applied.
                            - type: object
                              description: >-
                                The properties specific to the "rejectReferral"
                                effect. This gets triggered whenever the
                                referral code was rejected. See rejectionReason
                                for more info on why.
                              required:
                                - value
                                - rejectionReason
                              properties:
                                value:
                                  type: string
                                  description: The referral code that was rejected.
                                rejectionReason:
                                  type: string
                                  description: >-
                                    The reason why this referral code was
                                    rejected.
                                conditionIndex:
                                  type: integer
                                  description: >-
                                    The index of the condition that caused the
                                    rejection of the referral.
                                effectIndex:
                                  type: integer
                                  description: >-
                                    The index of the effect that caused the
                                    rejection of the referral.
                                details:
                                  type: string
                                  description: More details about the failure.
                                campaignExclusionReason:
                                  type: string
                                  example: CampaignGaveLowerDiscount
                                  description: The reason why the campaign was not applied.
                            - type: object
                              description: >-
                                The properties specific to the "couponCreated"
                                effect. This gets triggered whenever a validated
                                rule contained a "create coupon" effect, and a
                                coupon was created for a customer. See
                                "createdCoupons" on the response for all details
                                of this coupon.
                              required:
                                - value
                                - profileId
                              properties:
                                value:
                                  type: string
                                  description: The coupon code that was created.
                                profileId:
                                  type: string
                                  description: >-
                                    The integration identifier of the customer
                                    for whom this coupon was created.
                            - type: object
                              description: >-
                                The properties specific to the "referralCreated"
                                effect. This gets triggered whenever a validated
                                rule contained a "create referral" effect, and a
                                referral code was created for a customer. See
                                "createdReferrals" on the response for all
                                details of this referral code.
                              required:
                                - value
                              properties:
                                value:
                                  type: string
                                  description: The referral code that was created.
                            - type: object
                              description: >-
                                The properties specific to the "setDiscount"
                                effect. This gets triggered whenever a validated
                                rule contained a "set discount" effect. This is
                                a discount that should be applied on the scope
                                of defined with it.
                              required:
                                - name
                                - value
                              properties:
                                name:
                                  type: string
                                  description: The name / description of this discount
                                value:
                                  type: number
                                  description: The total monetary value of the discount.
                                scope:
                                  type: string
                                  description: >-
                                    The scope which the discount was applied on,
                                    can be one of
                                    (cartItems,additionalCosts,sessionTotal).
                                desiredValue:
                                  type: number
                                  description: The original value of the discount.
                            - type: object
                              description: >
                                The properties specific to the
                                `setDiscountPerItem` effect, triggered whenever
                                a validated rule contained a

                                "set per item discount" effect.

                                This is a discount that will be applied either
                                on a specific item, on a specific item +
                                additional cost or on all additional costs per
                                item.

                                This depends on the chosen scope.
                              required:
                                - name
                                - value
                                - position
                              properties:
                                name:
                                  type: string
                                  description: >
                                    The name of the discount. Contains a hashtag
                                    character indicating the index of the
                                    position of the item the discount applies

                                    to. It is identical to the value of the
                                    `position` property.
                                value:
                                  type: number
                                  description: The total monetary value of the discount.
                                position:
                                  type: number
                                  description: >-
                                    The index of the item in the cart items list
                                    on which this discount should be applied.
                                subPosition:
                                  type: number
                                  description: >
                                    For cart items with `quantity` > 1, the sub
                                    position indicates which item the discount
                                    applies to.
                                desiredValue:
                                  type: number
                                  description: The original value of the discount.
                                scope:
                                  type: string
                                  description: >
                                    The scope of the discount:

                                    - `additionalCosts`: The discount applies to
                                    all the additional costs of the item.

                                    - `itemTotal`: The discount applies to the
                                    price of the item + the additional costs of
                                    the item.

                                    - `price`: The discount applies to the price
                                    of the item.
                                totalDiscount:
                                  type: number
                                  description: >-
                                    The total discount given if this effect is a
                                    result of a prorated discount.
                                desiredTotalDiscount:
                                  type: number
                                  description: >-
                                    The original total discount to give if this
                                    effect is a result of a prorated discount.
                                bundleIndex:
                                  type: integer
                                  description: >-
                                    The position of the bundle in a list of item
                                    bundles created from the same bundle
                                    definition.
                                bundleName:
                                  type: string
                                  description: The name of the bundle definition.
                                targetedItemPosition:
                                  type: number
                                  description: >-
                                    The index of the targeted bundle item on
                                    which the applied discount is based.
                                targetedItemSubPosition:
                                  type: number
                                  description: >
                                    The sub-position of the targeted bundle item
                                    on which the applied discount is based.
                            - type: object
                              description: >-
                                The properties specific to the
                                "setDiscountPerAdditionalCost" effect. This gets
                                triggered whenever a validated rule contained a
                                "set per additional cost discount" effect. This
                                is a discount that should be applied on a
                                specific additional cost.
                              required:
                                - name
                                - value
                                - additionalCostId
                                - additionalCost
                              properties:
                                name:
                                  type: string
                                  description: The name / description of this discount
                                additionalCostId:
                                  type: integer
                                  description: The ID of the additional cost.
                                additionalCost:
                                  type: string
                                  description: The name of the additional cost.
                                value:
                                  type: number
                                  description: The total monetary value of the discount.
                                desiredValue:
                                  type: number
                                  description: The original value of the discount.
                            - type: object
                              description: >-
                                The properties specific to the "triggerWebhook"
                                effect. This gets triggered whenever a validated
                                rule contained a "trigger webhook" effect. This
                                is communicated as an FYI and should usually not
                                require action on your side.
                              required:
                                - webhookId
                                - webhookName
                              properties:
                                webhookId:
                                  type: number
                                  description: The ID of the webhook that was triggered.
                                webhookName:
                                  type: string
                                  description: The name of the webhook that was triggered.
                            - type: object
                              description: >
                                The properties specific to the
                                "addLoyaltyPoints" effect. This gets triggered
                                whenever a validated rule contained an "add
                                loyalty" effect. These points are automatically
                                stored and managed inside Talon.One.
                              required:
                                - name
                                - programId
                                - subLedgerId
                                - value
                                - recipientIntegrationId
                                - transactionUUID
                              properties:
                                name:
                                  type: string
                                  description: >-
                                    The name / description of this loyalty point
                                    addition.
                                programId:
                                  type: integer
                                  description: >-
                                    The ID of the loyalty program where these
                                    points were added.
                                subLedgerId:
                                  type: string
                                  description: >-
                                    The ID of the subledger within the loyalty
                                    program where these points were added.
                                value:
                                  type: number
                                  description: The amount of points that were added.
                                desiredValue:
                                  type: number
                                  description: >-
                                    The original amount of loyalty points to be
                                    awarded.
                                recipientIntegrationId:
                                  type: string
                                  maxLength: 1000
                                  description: The user for whom these points were added.
                                  example: URNGV8294NV
                                startDate:
                                  type: string
                                  format: date-time
                                  description: Date after which points will be valid.
                                expiryDate:
                                  type: string
                                  format: date-time
                                  description: Date after which points will expire.
                                transactionUUID:
                                  type: string
                                  description: >-
                                    The identifier of this addition in the
                                    loyalty ledger.
                                cartItemPosition:
                                  type: number
                                  description: >-
                                    The index of the item in the cart items list
                                    on which the loyal points addition should be
                                    applied.
                                cartItemSubPosition:
                                  type: number
                                  description: >
                                    For cart items with `quantity` > 1, the sub
                                    position indicates to which item the loyalty
                                    points addition is applied.
                                cardIdentifier:
                                  description: The card on which these points were added.
                                  type: string
                                  maxLength: 108
                                  minLength: 4
                                  pattern: ^[A-Za-z0-9_-]*$
                                  example: summer-loyalty-card-0543
                                bundleIndex:
                                  type: integer
                                  description: >-
                                    The position of the bundle in a list of item
                                    bundles created from the same bundle
                                    definition.
                                bundleName:
                                  type: string
                                  description: The name of the bundle definition.
                            - type: object
                              description: >-
                                The properties specific to the
                                "deductLoyaltyPoints" effect. This gets
                                triggered whenever a validated rule contained a
                                condition to only trigger when the given number
                                of loyalty points could be deduced. These points
                                are automatically stored and managed inside
                                Talon.One.
                              required:
                                - ruleTitle
                                - programId
                                - subLedgerId
                                - value
                                - transactionUUID
                                - name
                              properties:
                                ruleTitle:
                                  type: string
                                  description: >-
                                    The title of the rule that contained
                                    triggered this points deduction.
                                programId:
                                  type: integer
                                  description: >-
                                    The ID of the loyalty program where these
                                    points were added.
                                subLedgerId:
                                  type: string
                                  description: >-
                                    The ID of the subledger within the loyalty
                                    program where these points were added.
                                value:
                                  type: number
                                  description: The amount of points that were deducted.
                                transactionUUID:
                                  type: string
                                  description: >-
                                    The identifier of this deduction in the
                                    loyalty ledger.
                                name:
                                  type: string
                                  description: >
                                    The name property gets one of the following
                                    two values. It can be the loyalty program
                                    name or it can represent a reason for the
                                    respective deduction of loyalty points. The
                                    latter is an optional value defined in a
                                    deduction rule.
                                cardIdentifier:
                                  description: The card on which these points were added.
                                  type: string
                                  maxLength: 108
                                  minLength: 4
                                  pattern: ^[A-Za-z0-9_-]*$
                                  example: summer-loyalty-card-0543
                            - type: object
                              description: >
                                The properties specific to the
                                "changeLoyaltyTierLevel" effect.

                                This is triggered whenever the user's loyalty
                                tier is upgraded due to a validated rule that
                                contained an "addLoyaltyPoints" effect.
                              required:
                                - ruleTitle
                                - programId
                                - subLedgerId
                                - newTierName
                              properties:
                                ruleTitle:
                                  type: string
                                  description: >-
                                    The title of the rule that triggered the
                                    tier upgrade.
                                programId:
                                  type: integer
                                  description: >-
                                    The ID of the loyalty program where these
                                    points were added.
                                subLedgerId:
                                  type: string
                                  description: >-
                                    The ID of the subledger within the loyalty
                                    program where these points were added.
                                previousTierName:
                                  type: string
                                  description: >-
                                    The name of the tier from which the user was
                                    upgraded.
                                newTierName:
                                  type: string
                                  description: >-
                                    The name of the tier to which the user has
                                    been upgraded.
                                expiryDate:
                                  type: string
                                  format: date-time
                                  description: The expiration date of the new tier.
                            - type: object
                              description: >-
                                The properties specific to the "addFreeItem"
                                effect. This gets triggered whenever a validated
                                rule contained an "add free item" effect.
                              required:
                                - sku
                                - name
                              properties:
                                sku:
                                  type: string
                                  description: SKU of the item that needs to be added.
                                  example: SKU1241028
                                name:
                                  type: string
                                  description: The name / description of the effect
                                desiredQuantity:
                                  type: integer
                                  description: >-
                                    The original quantity in case a partial
                                    reward was applied.
                            - type: object
                              description: >-
                                The properties specific to the
                                "showNotification" effect. This gets triggered
                                whenever a validated rule contained a "show
                                notification" effect.
                              required:
                                - notificationType
                                - title
                                - body
                              properties:
                                notificationType:
                                  type: string
                                  description: >-
                                    The type of notification that should be
                                    shown (e.g. error/warning/info).
                                title:
                                  type: string
                                  description: Title of the notification.
                                body:
                                  type: string
                                  description: Body of the notification.
                            - type: object
                              description: >-
                                The properties specific to the "updateAttribute"
                                effect. This gets triggered whenever a validated
                                rule contained an "update an attribute" effect.
                              required:
                                - path
                                - value
                              properties:
                                path:
                                  type: string
                                  description: >-
                                    The exact path of the attribute that was
                                    updated.
                                value:
                                  description: >
                                    The new value of this attribute. The value
                                    can be of the following types:

                                    - boolean

                                    - location

                                    - number

                                    - string

                                    - time

                                    - list of any of those types
                            - type: object
                              description: >-
                                The properties specific to the "rollbackCoupon"
                                effect. This gets triggered whenever previously
                                closed session is now cancelled and a coupon
                                redemption was cancelled on our internal usage
                                limit counters.
                              required:
                                - value
                              properties:
                                value:
                                  type: string
                                  description: >-
                                    The coupon code whose usage has been rolled
                                    back.
                            - type: object
                              description: >-
                                The properties specific to the
                                "rollbackReferral" effect. This gets triggered
                                whenever previously closed session is now
                                cancelled and a referral redemption was
                                cancelled on our internal usage limit counters.
                              required:
                                - value
                              properties:
                                value:
                                  type: string
                                  description: >-
                                    The referral code whose usage has been
                                    rolled back.
                            - type: object
                              description: >-
                                The properties specific to the
                                "rollbackDiscount" effect. This gets triggered
                                whenever previously closed session is now
                                cancelled or partially returned and a
                                setDiscount effect was cancelled on our internal
                                discount limit counters.
                              required:
                                - name
                                - value
                              properties:
                                name:
                                  type: string
                                  description: >-
                                    The name of the "setDiscount" effect that
                                    was rolled back.
                                value:
                                  type: number
                                  description: >-
                                    The value of the discount that was rolled
                                    back.
                                cartItemPosition:
                                  type: number
                                  description: >-
                                    The index of the item in the cart items for
                                    which the discount was rolled back.
                                cartItemSubPosition:
                                  type: number
                                  description: >
                                    For cart items with `quantity` > 1, the
                                    subposition returns the index of the item
                                    unit in its line item.
                                additionalCostId:
                                  type: integer
                                  description: >-
                                    The ID of the additional cost that was
                                    rolled back.
                                additionalCost:
                                  type: string
                                  description: >-
                                    The name of the additional cost that was
                                    rolled back.
                                scope:
                                  type: string
                                  description: >
                                    The scope of the rolled back discount

                                    - For a discount per session, it can be one
                                    of `cartItems`, `additionalCosts` or
                                    `sessionTotal`

                                    - For a discount per item, it can be one of
                                    `price`, `additionalCosts` or `itemTotal`
                            - type: object
                              description: >-
                                The properties specific to the
                                "rollbackAddedLoyaltyPoints" effect. This gets
                                triggered whenever previously a closed session
                                with an addLoyaltyPoints effect is cancelled.
                              required:
                                - programId
                                - subLedgerId
                                - value
                                - recipientIntegrationId
                                - transactionUUID
                              properties:
                                programId:
                                  type: integer
                                  description: >-
                                    The ID of the loyalty program where the
                                    points were originally added.
                                subLedgerId:
                                  type: string
                                  description: >-
                                    The ID of the subledger within the loyalty
                                    program where these points were originally
                                    added.
                                value:
                                  type: number
                                  description: The amount of points that were rolled back.
                                recipientIntegrationId:
                                  type: string
                                  maxLength: 1000
                                  description: >-
                                    The user for whom these points were
                                    originally added.
                                  example: URNGV8294NV
                                transactionUUID:
                                  type: string
                                  description: >-
                                    The identifier of 'deduction' entry added to
                                    the ledger as the `addLoyaltyPoints` effect
                                    is rolled back.
                                cartItemPosition:
                                  type: number
                                  description: >-
                                    The index of the item in the cart items for
                                    which the loyalty points were rolled back.
                                cartItemSubPosition:
                                  type: number
                                  description: >
                                    For cart items with `quantity` > 1, the
                                    sub-position indicates to which item the
                                    loyalty points were rolled back.
                                cardIdentifier:
                                  description: >-
                                    The card on which these points were
                                    originally added.
                                  type: string
                                  maxLength: 108
                                  minLength: 4
                                  pattern: ^[A-Za-z0-9_-]*$
                                  example: summer-loyalty-card-0543
                            - type: object
                              description: >-
                                The properties specific to the
                                "rollbackDeductedLoyaltyPoints" effect. This
                                effect is triggered whenever a previously closed
                                session is cancelled and a deductLoyaltyPoints
                                effect was revoked.
                              required:
                                - programId
                                - subLedgerId
                                - value
                                - recipientIntegrationId
                                - transactionUUID
                              properties:
                                programId:
                                  type: integer
                                  description: >-
                                    The ID of the loyalty program where these
                                    points were reimbursed.
                                subLedgerId:
                                  type: string
                                  description: >-
                                    The ID of the subledger within the loyalty
                                    program where these points were reimbursed.
                                value:
                                  type: number
                                  description: >-
                                    The amount of reimbursed points that were
                                    added.
                                recipientIntegrationId:
                                  type: string
                                  maxLength: 1000
                                  description: >-
                                    The user for whom these points were
                                    reimbursed.
                                  example: URNGV8294NV
                                startDate:
                                  type: string
                                  format: date-time
                                  description: >-
                                    Date after which the reimbursed points will
                                    be valid.
                                expiryDate:
                                  type: string
                                  format: date-time
                                  description: >-
                                    Date after which the reimbursed points will
                                    expire.
                                transactionUUID:
                                  type: string
                                  description: >-
                                    The identifier of 'addition' entries added
                                    to the ledger as the `deductLoyaltyPoints`
                                    effect is rolled back.
                                cardIdentifier:
                                  description: The card on which these points were added.
                                  type: string
                                  maxLength: 108
                                  minLength: 4
                                  pattern: ^[A-Za-z0-9_-]*$
                                  example: summer-loyalty-card-0543
                            - type: object
                              description: >
                                This effect is **deprecated**.

                                The properties specific to the
                                "ShowBundleMetadata" effect. This effect
                                contains information that allows you to
                                associate the discounts from a rule in a bundle
                                campaign with specific cart items. This way you
                                can distinguish from "normal" discounts that
                                were not the result of a product bundle.
                              required:
                                - description
                                - bundleAttributes
                                - itemsIndices
                              properties:
                                description:
                                  type: string
                                  description: Description of the product bundle.
                                bundleAttributes:
                                  type: array
                                  items:
                                    type: string
                                  description: >-
                                    The cart item attributes that determined
                                    which items are being bundled together.
                                itemsIndices:
                                  type: array
                                  items:
                                    type: number
                                  description: >-
                                    The indices in the cart items array of the
                                    bundled items.
                            - type: object
                              description: >-
                                The properties specific to the "awardGiveaway"
                                effect. This effect contains information on the
                                giveaway item, and which profile it was awarded
                                to.
                              required:
                                - poolId
                                - poolName
                                - recipientIntegrationId
                                - giveawayId
                                - code
                              properties:
                                poolId:
                                  type: integer
                                  description: >-
                                    The ID of the giveaways pool the code was
                                    taken from.
                                  example: 2
                                poolName:
                                  type: string
                                  description: >-
                                    The name of the giveaways pool the code was
                                    taken from.
                                  example: My pool
                                recipientIntegrationId:
                                  type: string
                                  maxLength: 1000
                                  description: >-
                                    The integration ID of the profile that was
                                    awarded the giveaway.
                                  example: URNGV8294NV
                                giveawayId:
                                  type: integer
                                  description: >-
                                    The internal ID for the giveaway that was
                                    awarded.
                                  example: 5
                                code:
                                  type: string
                                  description: The giveaway code that was awarded.
                                  example: 57638t-67439hty
                            - type: object
                              description: >-
                                The properties specific to the "awardGiveaway"
                                effect when the session is not closed yet. This
                                effect replaces "awardGiveaway" only when
                                updating a session with any state other than
                                "closed". This is to ensure no giveaway codes
                                are leaked when they are still not guaranteed to
                                be awarded.
                              required:
                                - poolId
                                - poolName
                                - recipientIntegrationId
                              properties:
                                poolId:
                                  type: integer
                                  description: >-
                                    The ID of the giveaways pool the code will
                                    be taken from.
                                  example: 2
                                poolName:
                                  type: string
                                  description: >-
                                    The name of the giveaways pool the code will
                                    be taken from.
                                  example: My pool
                                recipientIntegrationId:
                                  type: string
                                  maxLength: 1000
                                  description: >-
                                    The integration ID of the profile that will
                                    be awarded the giveaway.
                                  example: URNGV8294NV
                            - type: object
                              description: >-
                                Whenever an error occurred during evaluation, we
                                return an error effect. This should never happen
                                for rules created in the rule builder.
                              required:
                                - message
                              properties:
                                message:
                                  type: string
                                  description: The error message.
                            - type: object
                              description: Effect containing custom payload.
                              required:
                                - effectId
                                - name
                                - payload
                              properties:
                                effectId:
                                  type: integer
                                  description: >-
                                    The ID of the custom effect that was
                                    triggered.
                                  example: 1
                                name:
                                  type: string
                                  description: The type of the custom effect.
                                  example: my_custom_effect
                                cartItemPosition:
                                  type: number
                                  description: >-
                                    The index of the item in the cart item list
                                    to which the custom effect is applied.
                                  example: 1
                                cartItemSubPosition:
                                  type: number
                                  description: >
                                    For cart items with quantity > 1, the sub
                                    position indicates to which item unit the
                                    custom effect is applied.
                                  example: 2
                                bundleIndex:
                                  type: integer
                                  description: >-
                                    The position of the bundle in a list of item
                                    bundles created from the same bundle
                                    definition.
                                  example: 1
                                bundleName:
                                  type: string
                                  description: The name of the bundle definition.
                                  example: my_bundle
                                payload:
                                  description: The JSON payload of the custom effect.
                                  type: object
                                  x-arbitraryJSON: true
                            - type: object
                              description: >-
                                The properties specific to the
                                "setDiscountPerAdditionalCostPerItem" effect.
                                This gets triggered whenever a validated rule
                                contained a "set discount per additional cost
                                per item" effect. This is a discount that should
                                be applied on a specific additional cost in a
                                specific item.
                              required:
                                - name
                                - value
                                - additionalCostId
                                - additionalCost
                                - position
                              properties:
                                name:
                                  type: string
                                  description: The name / description of this discount
                                additionalCostId:
                                  type: integer
                                  description: The ID of the additional cost.
                                value:
                                  type: number
                                  description: The total monetary value of the discount.
                                position:
                                  type: number
                                  description: >-
                                    The index of the item in the cart item list
                                    containing the additional cost to be
                                    discounted.
                                subPosition:
                                  type: number
                                  description: >
                                    For cart items with `quantity` > 1, the sub
                                    position indicates which item the discount
                                    applies to.
                                additionalCost:
                                  type: string
                                  description: The name of the additional cost.
                                desiredValue:
                                  type: number
                                  description: >
                                    Only with [partial discounts
                                    enabled](https://docs.talon.one/docs/product/campaigns/campaign-evaluation/#partial-discounts).

                                    Represents the monetary value of the
                                    discount to be applied to additional
                                    discount without considering budget
                                    limitations.
                            - type: object
                              description: >-
                                The properties specific to the "reserveCoupon"
                                effect. This gets triggered whenever a validated
                                rule contained a "reserve coupon" effect. This
                                reserves the coupon currently on scope to the
                                profile on scope.
                              required:
                                - couponValue
                                - profileIntegrationId
                                - isNewReservation
                              properties:
                                couponValue:
                                  type: string
                                  description: The value of the coupon currently on scope.
                                profileIntegrationId:
                                  type: string
                                  description: >-
                                    The ID of this customer profile in the
                                    third-party integration.
                                isNewReservation:
                                  type: boolean
                                  description: >-
                                    Indicates whether this is a new coupon
                                    reservation or not.
                            - type: object
                              description: >-
                                The properties specific to the "addToAudience"
                                effect. This gets triggered whenever a validated
                                rule contains an "addToAudience" effect.
                              properties:
                                audienceId:
                                  type: integer
                                  description: The internal ID of the audience.
                                  example: 10
                                audienceName:
                                  type: string
                                  description: The name of the audience.
                                  example: My audience
                                profileIntegrationId:
                                  type: string
                                  description: >-
                                    The ID of the customer profile in the
                                    third-party integration platform.
                                  example: URNGV8294NV
                                profileId:
                                  type: integer
                                  description: The internal ID of the customer profile.
                                  example: 150
                            - type: object
                              description: >-
                                The properties specific to the
                                "removeFromAudience" effect. This gets triggered
                                whenever a validated rule contains a
                                "removeFromAudience" effect.
                              properties:
                                audienceId:
                                  type: integer
                                  description: The internal ID of the audience.
                                  example: 10
                                audienceName:
                                  type: string
                                  description: The name of the audience.
                                  example: My audience
                                profileIntegrationId:
                                  type: string
                                  description: >-
                                    The ID of the customer profile in the
                                    third-party integration platform.
                                  example: URNGV8294NV
                                profileId:
                                  type: integer
                                  description: The internal ID of the customer profile.
                                  example: 150
                            - type: object
                              description: >-
                                The properties specific to the
                                "increaseAchievementProgress" effect. This gets
                                triggered whenever a validated rule contained an
                                "increase customer progress" effect.
                              required:
                                - achievementId
                                - achievementName
                                - delta
                                - value
                                - target
                                - isJustCompleted
                              properties:
                                achievementId:
                                  type: integer
                                  description: The internal ID of the achievement.
                                  example: 10
                                achievementName:
                                  type: string
                                  description: The name of the achievement.
                                  example: FreeCoffee10Orders
                                progressTrackerId:
                                  type: integer
                                  description: >-
                                    The internal ID of the achievement progress
                                    tracker.
                                delta:
                                  type: number
                                  description: >-
                                    The value by which the customer's current
                                    progress in the achievement is increased.
                                value:
                                  type: number
                                  description: >-
                                    The current progress of the customer in the
                                    achievement.
                                target:
                                  type: number
                                  description: >-
                                    The target value to complete the
                                    achievement.
                                isJustCompleted:
                                  type: boolean
                                  description: >-
                                    Indicates if the customer has completed the
                                    achievement in the current session.
                            - type: object
                              description: >-
                                The properties specific to the
                                "rollbackIncreasedAchievementProgress" effect.
                                This gets triggered whenever a closed session
                                where the `increaseAchievementProgress` effect
                                was triggered is cancelled. This is applicable
                                only when the customer has not completed the
                                achievement.
                              required:
                                - achievementId
                                - achievementName
                                - progressTrackerId
                                - decreaseProgressBy
                                - currentProgress
                                - target
                              properties:
                                achievementId:
                                  type: integer
                                  description: The internal ID of the achievement.
                                  example: 10
                                achievementName:
                                  type: string
                                  description: The name of the achievement.
                                  example: FreeCoffee10Orders
                                progressTrackerId:
                                  type: integer
                                  description: >-
                                    The internal ID of the achievement progress
                                    tracker.
                                decreaseProgressBy:
                                  type: number
                                  description: >-
                                    The value by which the customer's current
                                    progress in the achievement is decreased.
                                currentProgress:
                                  type: number
                                  description: >-
                                    The current progress of the customer in the
                                    achievement.
                                target:
                                  type: number
                                  description: >-
                                    The target value to complete the
                                    achievement.
                            - type: object
                              description: >
                                The properties specific to the
                                "extendLoyaltyPointsExpiryDate" effect. This
                                gets triggered when a validated rule contains
                                the "extend expiry date" effect. The current
                                expiry date gets extended by the time frame
                                given in the effect.
                              required:
                                - programId
                                - subLedgerId
                                - extensionDuration
                                - previousExpirationDate
                              properties:
                                programId:
                                  type: integer
                                  description: >-
                                    ID of the loyalty program that contains
                                    these points.
                                subLedgerId:
                                  type: string
                                  description: >-
                                    API name of the loyalty program subledger
                                    that contains these points. added.
                                extensionDuration:
                                  type: string
                                  description: >
                                    Time frame by which the expiry date extends.


                                    The time format is either:

                                    - immediate, or

                                    - an **integer** followed by a letter
                                    indicating the time unit.


                                    Examples: `immediate`, `30s`, `40m`, `1h`,
                                    `5D`, `7W`, `10M`, `15Y`.


                                    Available units:


                                    - `s`: seconds

                                    - `m`: minutes

                                    - `h`: hours

                                    - `D`: days

                                    - `W`: weeks

                                    - `M`: months

                                    - `Y`: years


                                    You can round certain units up or down:

                                    - `_D` for rounding down days only.
                                    Signifies the start of the day.

                                    - `_U` for rounding up days, weeks, months
                                    and years. Signifies the end of the day,
                                    week, month or year.
                                  example: 12h
                                affectedTransactions:
                                  type: array
                                  description: >-
                                    List of transactions affected by the expiry
                                    date update.
                                  items:
                                    type: object
                                    description: >-
                                      The properties specific to effects for
                                      changing the expiry dates of loyalty
                                      ledger entries.
                                    required:
                                      - transactionUUID
                                      - newExpiryDate
                                    properties:
                                      transactionUUID:
                                        type: string
                                        format: uuid
                                        description: >-
                                          The identifier of the transaction
                                          affected by the extension or update.
                                      previousExpiryDate:
                                        type: string
                                        format: date-time
                                        description: >-
                                          Expiry date of the transactions before
                                          applying the extension or update.
                                      newExpiryDate:
                                        type: string
                                        format: date-time
                                        description: >-
                                          Expiry date of the transaction after
                                          applying the extension or update.
    '400':
      description: Bad request
      content:
        application/json:
          schema:
            type: object
            required:
              - message
            properties:
              message:
                type: string
                description: A message describing the error.
              errors:
                type: array
                description: >-
                  An array of individual problems encountered during the
                  request.
                items:
                  type: object
                  required:
                    - source
                    - title
                  properties:
                    title:
                      type: string
                      description: Short description of the problem.
                    details:
                      type: string
                      description: >-
                        Longer description of this specific instance of the
                        problem.
                    source:
                      type: object
                      description: >
                        The source of the current error, exactly one of
                        `pointer`, `parameter` or `line` will be defined.
                      properties:
                        pointer:
                          type: string
                          description: >-
                            Pointer to the path in the payload that caused this
                            error.
                        parameter:
                          type: string
                          description: Query parameter that caused this error.
                        line:
                          type: string
                          description: >-
                            Line number in uploaded multipart file that caused
                            this error. 'N/A' if unknown.
                        resource:
                          type: string
                          description: Pointer to the resource that caused this error.
    '401':
      description: Unauthorized - Invalid API key
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
              errors:
                type: array
                description: >-
                  An array of individual problems encountered during the
                  request.
                items:
                  type: object
                  required:
                    - source
                    - title
                  properties:
                    title:
                      type: string
                      description: Short description of the problem.
                    details:
                      type: string
                      description: >-
                        Longer description of this specific instance of the
                        problem.
                    source:
                      type: object
                      description: >
                        The source of the current error, exactly one of
                        `pointer`, `parameter` or `line` will be defined.
                      properties:
                        pointer:
                          type: string
                          description: >-
                            Pointer to the path in the payload that caused this
                            error.
                        parameter:
                          type: string
                          description: Query parameter that caused this error.
                        line:
                          type: string
                          description: >-
                            Line number in uploaded multipart file that caused
                            this error. 'N/A' if unknown.
                        resource:
                          type: string
                          description: Pointer to the resource that caused this error.
              StatusCode:
                type: integer
                description: The error code
