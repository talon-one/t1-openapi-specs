# path: /v1/best_prior_price
post:
  operationId: bestPriorPrice
  summary: Fetch best prior price
  description: >
    Returns the best prior price based on historical pricing data for the
    specified SKUs within a defined timeframe.
  tags:
    - Attributes
  requestBody:
    content:
      application/json:
        schema:
          type: object
          required:
            - skus
            - timeframeEndDate
            - timeframe
            - strictEndDate
          properties:
            skus:
              type: array
              minItems: 1
              description: >-
                List of product SKUs to check when determining the best prior
                price.
              items:
                type: string
              example:
                - comma
                - period
            timeframeEndDate:
              type: string
              format: date-time
              description: >-
                The end date and time that defines the latest time for
                retrieving historical SKU prices.
              example: '2020-11-10T23:00:00Z'
            timeframe:
              type: string
              format: integer
              description: >-
                The number of days prior to the timeframeEndDate. Only prices
                within this look back period are considered for the best prior
                price evaluation.
              example: 30
            strictEndDate:
              type: boolean
              description: >
                Indicates whether the timeframe includes the start of the
                current sale.

                - When `false`, the timeframe includes the start date of the
                current sale.

                - When `true`, the timeframe striclty uses the number of days
                specified in `timeframe`.
              example: true
            target:
              type: object
              required:
                - targetType
              description: >-
                Specifies the target for which the best prior price calculation
                is taken into consideration.
              properties:
                targetType:
                  type: string
                  enum:
                    - NONE
                    - AUDIENCE
                  description: The type of price target.
                  example: AUDIENCE
                audienceID:
                  type: integer
                  description: >-
                    The AudienceID of an audience. Must be used with "AUDIENCE"
                    target type.
                  example: 4
    description: body
    required: true
  responses:
    '200':
      description: Ok
      content:
        application/json:
          schema:
            type: array
            items:
              type: object
              required:
                - sku
                - observedAt
                - price
                - adjustmentAssociationId
                - metadata
                - target
              properties:
                sku:
                  type: string
                  description: sku
                  example: NVR-GN-GV-UUP
                observedAt:
                  type: string
                  format: date-time
                  description: The date and time when the best price was observed.
                  example: '2020-11-10T23:00:00Z'
                adjustmentAssociationId:
                  type: string
                  description: >
                    The association ID of the adjustment context active at the
                    time of observation.
                  example: Summer Sale 2007
                price:
                  type: number
                  description: Price of the item.
                  example: 99.99
                metadata:
                  type: object
                  description: Auxiliary data for found price observation.
                  properties:
                    influencingCampaignIDs:
                      type: array
                      items:
                        type: integer
                    adjustmentReferenceID:
                      type: string
                      description: >-
                        Identifier related to the `referenceId` used during a
                        `ADD_PRICE_ADJUSTMENT` action  using the [Sync cart item
                        catalog
                        endpoint](https://docs.talon.one/integration-api#tag/Catalogs/operation/syncCatalog).
                target:
                  type: object
                  oneOf:
                    - type: object
                      description: Represents the target type when no entity is selected.
                      properties:
                        type:
                          type: string
                          enum:
                            - NONE
                      required:
                        - type
                    - type: object
                      description: |
                        Represents the targeted audience.
                      properties:
                        type:
                          type: string
                          enum:
                            - AUDIENCE
                        audience:
                          allOf:
                            - type: object
                              required:
                                - id
                              properties:
                                id:
                                  type: integer
                                  description: The ID of the audience.
                                integration:
                                  type: string
                                  description: The third-party integration of the audience.
                            - type: object
                              properties:
                                integrationId:
                                  type: string
                                  minLength: 1
                                  maxLength: 1000
                                  description: >-
                                    The ID of this audience in the third-party
                                    integration.
                                  example: 382370BKDB946
                      required:
                        - type
                        - audience
