# path: /v1/best_prior_price
post:
  operationId: bestPriorPrice
  summary: Fetch best prior price
  description: >
    Returns the best prior price based on historical pricing data for the
    specified SKUs within a defined timeframe.
  tags:
    - Catalogs
  requestBody:
    content:
      application/json:
        schema:
          type: object
          required:
            - skus
            - timeframeEndDate
            - timeframe
            - strictEndDate
          properties:
            skus:
              type: array
              minItems: 1
              description: >-
                List of product SKUs to check when determining the best prior
                price.
              items:
                type: string
              example:
                - comma
                - period
            timeframeEndDate:
              type: string
              format: date-time
              description: >-
                The end date and time that defines the latest time for
                retrieving historical SKU prices.
              example: '2020-11-10T23:00:00Z'
            timeframe:
              type: string
              description: >-
                The number of days prior to the timeframeEndDate. Only prices
                within this look back period are considered for the best prior
                price evaluation.
              example: '30'
            strictEndDate:
              type: boolean
              description: >
                Indicates whether the timeframe includes the start of the
                current sale.

                - When `false`, the timeframe includes the start date of the
                current sale.

                - When `true`, the timeframe striclty uses the number of days
                specified in `timeframe`.
              example: true
            target:
              type: object
              required:
                - targetType
              description: >-
                Specifies the target for which the best prior price calculation
                is taken into consideration.
              properties:
                targetType:
                  type: string
                  enum:
                    - NONE
                    - AUDIENCE
                  description: The type of price target.
                  example: AUDIENCE
                audienceID:
                  type: integer
                  description: >-
                    The AudienceID of an audience. Must be used with "AUDIENCE"
                    target type.
                  example: 4
    description: body
    required: true
  responses:
    '200':
      description: Ok
      content:
        application/json:
          schema:
            type: array
            items:
              type: object
              required:
                - sku
                - observedAt
                - price
                - contextId
                - metadata
                - target
              properties:
                sku:
                  type: string
                  description: sku
                  example: NVR-GN-GV-UUP
                observedAt:
                  type: string
                  format: date-time
                  description: The date and time when the best price was observed.
                  example: '2020-11-10T23:00:00Z'
                contextId:
                  type: string
                  description: >
                    The context ID of the context active at the time of
                    observation.
                  example: Summer Sale 2007
                price:
                  type: number
                  description: Price of the item.
                  example: 99.99
                metadata:
                  type: object
                  description: Auxiliary data for found price observation.
                  properties:
                    influencingCampaignDetails:
                      type: array
                      description: Details about campaigns that influenced the final price.
                      items:
                        type: object
                        description: >-
                          Details about a campaign that influenced the final
                          price.
                        properties:
                          campaignId:
                            type: integer
                            description: >-
                              Identifier of the campaign that influenced the
                              final price.
                          discountValue:
                            type: number
                            description: Discount value applied by the campaign.
                        required:
                          - campaignId
                          - discountValue
                    adjustmentDetails:
                      type: object
                      description: Details about the applied price adjustment.
                      properties:
                        referenceId:
                          type: string
                          description: >-
                            The reference identifier used during an
                            `ADD_PRICE_ADJUSTMENT` action.
                          example: 68851723-e6fa-488f-ace9-112581e6c19b
                        selectedPriceType:
                          type: string
                          description: >-
                            The selected price type for the SKU targeted by this
                            effect.
                          example: member
                        value:
                          type: number
                          description: The value of the applied price adjustment.
                      required:
                        - referenceId
                        - selectedPriceType
                        - value
                  required:
                    - influencingCampaignDetails
                target:
                  type: object
                  oneOf:
                    - type: object
                      description: Represents the target type when no entity is selected.
                      properties:
                        type:
                          type: string
                          enum:
                            - NONE
                      required:
                        - type
                    - type: object
                      description: |
                        Represents the targeted audience.
                      properties:
                        type:
                          type: string
                          enum:
                            - AUDIENCE
                        audience:
                          allOf:
                            - type: object
                              required:
                                - id
                              properties:
                                id:
                                  type: integer
                                  description: The ID of the audience.
                                integration:
                                  type: string
                                  description: The third-party integration of the audience.
                            - type: object
                              properties:
                                integrationId:
                                  type: string
                                  minLength: 1
                                  maxLength: 1000
                                  description: >-
                                    The ID of this audience in the third-party
                                    integration.
                                  example: 382370BKDB946
                      required:
                        - type
                        - audience
